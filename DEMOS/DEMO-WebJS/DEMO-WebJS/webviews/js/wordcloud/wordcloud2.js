"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var t=[void 0],e="zero-timeout-message",i=function(i){var o=t.length;return t.push(i),window.postMessage(e+o.toString(36),"*"),o};return window.addEventListener("message",function(i){if("string"==typeof i.data&&i.data.substr(0,e.length)===e){i.stopImmediatePropagation();var o=parseInt(i.data.substr(e.length),36);t[o]&&(t[o](),t[o]=void 0)}},!0),window.clearImmediate=function(e){t[e]&&(t[e]=void 0)},i}()||function(t){window.setTimeout(t,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}}()),function(t){var e=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return e.getImageData&&e.fillText&&Array.prototype.some&&Array.prototype.push?!0:!1}(),i=function(){if(e){for(var t,i,o=document.createElement("canvas").getContext("2d"),r=20;r;){if(o.font=r.toString(10)+"px sans-serif",o.measureText("Ｗ").width===t&&o.measureText("m").width===i)return r+1;t=o.measureText("Ｗ").width,i=o.measureText("m").width,r--}return 0}}(),o=function(t){for(var e,i,o=t.length;o;e=Math.floor(Math.random()*o),i=t[--o],t[o]=t[e],t[e]=i);return t},r=function(t,r){function a(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}if(e){Array.isArray(t)||(t=[t]),t.forEach(function(e,i){if("string"==typeof e){if(t[i]=document.getElementById(e),!t[i])throw"The element id specified is not found."}else if(!e.tagName&&!e.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var n={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,customRotations:[],shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,hover:null,click:null};if(r)for(var l in r)l in n&&(n[l]=r[l]);if("function"!=typeof n.weightFactor){var s=n.weightFactor;n.weightFactor=function(t){return t*s}}if("function"!=typeof n.shape)switch(n.shape){case"circle":default:n.shape="circle";break;case"cardioid":n.shape=function(t){return 1-Math.sin(t)};break;case"diamond":case"square":n.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"triangle-forward":n.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":n.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":n.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":n.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}n.gridSize=Math.max(Math.floor(n.gridSize),4);var d,f,h,c,u,m,g,v=n.gridSize,w=v-n.maskGapWidth,p=Math.abs(n.maxRotation-n.minRotation),x=Math.min(n.maxRotation,n.minRotation);switch(n.color){case"random-dark":g=function(){return a(10,50)};break;case"random-light":g=function(){return a(50,90)};break;default:"function"==typeof n.color&&(g=n.color)}var M,b=!1,y=[],C=null,T={},I=function(t){var e="wordCloudhighlightCanvas",i=window.devicePixelRatio||1;if(C=document.getElementById(e))C.width=t.width,C.height=t.height,C.style.width=t.width/i+"px",C.style.height=t.height/i+"px";else{var o=t.parentNode||t.parentElement;C=document.createElement("canvas"),C.id=e,C.width=t.width,C.height=t.height,C.style.width=t.width/i+"px",C.style.height=t.height/i+"px",C.style.top="0px",C.style.left="0px",C.style["pointer-events"]="none",C.style.position="absolute",o.appendChild(C)}},k=function(t){var e=t.currentTarget,i=e.getBoundingClientRect(),o=t.clientX-i.left,r=t.clientY-i.top,a=Math.floor(o*(e.width/i.width||1)/v),n=Math.floor(r*(e.height/i.height||1)/v);return y[a][n]},S=function(t){var e=k(t);if(M!==e)return M=e,e?void n.hover(e.item,e.dimension,t):void n.hover(void 0,void 0,t)},E=function(t){var e=k(t);if(e){n.click(e.item,e.dimension,t);var i=T[e.item[0]];i&&O(i.gx,i.gy,i.info,i.word,i.weight,i.distance,i.theta,i.rotateDeg,i.attributes)}},R=[],P=function(t){if(R[t])return R[t];var e=8*t,i=e,o=[];for(0===t&&o.push([c[0],c[1],0]);i--;){var r=1;"circle"!==n.shape&&(r=n.shape(i/e*2*Math.PI)),o.push([c[0]+t*r*Math.cos(-i/e*2*Math.PI),c[1]+t*r*Math.sin(-i/e*2*Math.PI)*n.ellipticity,i/e*2*Math.PI])}return R[t]=o,o},F=function(){return n.abortThreshold>0&&(new Date).getTime()-m>n.abortThreshold},z=function(){if(0===n.rotateRatio)return 0;if(n.list.length<=5)return 0;if(n.customRotations.length>0){var t=Math.ceil(Math.random()*n.customRotations.length);return n.customRotations[t]?n.customRotations[t]:0}return Math.random()>n.rotateRatio?0:0===p?x:x+Math.random()*p},W=function(t,e,o){var r=!1,a=n.weightFactor(e);if(a<=n.minSize)return!1;var l=1;i>a&&(l=function(){for(var t=2;i>t*a;)t+=2;return t}());var s=document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});d.font=n.fontWeight+" "+(a*l).toString(10)+"px "+n.fontFamily;var f=d.measureText(t).width/l,h=Math.max(a*l,d.measureText("m").width,d.measureText("Ｗ").width)/l,c=f+2*h,u=3*h,m=Math.ceil(c/v),g=Math.ceil(u/v);c=m*v,u=g*v;var w=-f/2,p=.4*-h,x=Math.ceil((c*Math.abs(Math.sin(o))+u*Math.abs(Math.cos(o)))/v),M=Math.ceil((c*Math.abs(Math.cos(o))+u*Math.abs(Math.sin(o)))/v),b=M*v,y=x*v;s.setAttribute("width",b),s.setAttribute("height",y),r&&(document.body.appendChild(s),d.save()),d.scale(1/l,1/l),d.translate(b*l/2,y*l/2),d.rotate(-o),d.font=n.fontWeight+" "+(a*l).toString(10)+"px "+n.fontFamily,d.fillStyle="#000",d.textBaseline="middle",d.fillText(t,w*l,(p+.5*a)*l);var C=d.getImageData(0,0,b,y).data;if(F())return!1;r&&(d.strokeRect(w*l,p,f*l,h*l),d.restore());for(var T,I,k,S=[],E=M,R=[x/2,M/2,x/2,M/2];E--;)for(T=x;T--;){k=v;t:{for(;k--;)for(I=v;I--;)if(C[4*((T*v+k)*b+(E*v+I))+3]){S.push([E,T]),E<R[3]&&(R[3]=E),E>R[1]&&(R[1]=E),T<R[0]&&(R[0]=T),T>R[2]&&(R[2]=T),r&&(d.fillStyle="rgba(255, 0, 0, 0.5)",d.fillRect(E*v,T*v,v-.5,v-.5));break t}r&&(d.fillStyle="rgba(0, 0, 255, 0.5)",d.fillRect(E*v,T*v,v-.5,v-.5))}}return r&&(d.fillStyle="rgba(0, 255, 0, 0.5)",d.fillRect(R[3]*v,R[0]*v,(R[1]-R[3]+1)*v,(R[2]-R[0]+1)*v)),{mu:l,occupied:S,bounds:R,gw:M,gh:x,fillTextOffsetX:w,fillTextOffsetY:p,fillTextWidth:f,fillTextHeight:h,fontSize:a}},L=function(t,e,i,o,r){for(var a=r.length;a--;){var n=t+r[a][0],l=e+r[a][1];if(n>=f||l>=h||0>n||0>l||!d[n][l])return!1}return!0},O=function(t,e,i,o,r,a,l,s,d){var f,h=i.fontSize,c=n.highlightColor||"rgba(255, 255, 255, 0.2)",u=i.bounds;f={x:(t+u[3])*v,y:(e+u[0])*v,w:(u[1]-u[3]+1)*v,h:(u[2]-u[0]+1)*v};var m=C;if(m.getContext){var g=m.getContext("2d"),w=i.mu;g.clearRect(0,0,m.width,m.height),g.save(),g.scale(1/w,1/w),g.font=n.fontWeight+" "+(h*w).toString(10)+"px "+n.fontFamily,g.fillStyle=c,g.translate((t+i.gw/2)*v*w,(e+i.gh/2)*v*w),0!==s&&g.rotate(-s),g.textBaseline="middle",g.fillText(o,i.fillTextOffsetX*w,(i.fillTextOffsetY+.5*h)*w),g.restore()}},A=function(e,i,o,r,a,l,s,d,f){var h,c=o.fontSize;h=g?g(r,a,c,l,s):n.color;var u,m=o.bounds;u={x:(e+m[3])*v,y:(i+m[0])*v,w:(m[1]-m[3]+1)*v,h:(m[2]-m[0]+1)*v},t.forEach(function(t){if(t.getContext){var a=t.getContext("2d"),l=o.mu;a.save(),a.scale(1/l,1/l),a.font=n.fontWeight+" "+(c*l).toString(10)+"px "+n.fontFamily,a.fillStyle=h,a.translate((e+o.gw/2)*v*l,(i+o.gh/2)*v*l),0!==d&&a.rotate(-d),a.textBaseline="middle",a.fillText(r,o.fillTextOffsetX*l,(o.fillTextOffsetY+.5*c)*l),a.restore()}else{var s=document.createElement("span"),u="";u="rotate("+-d/Math.PI*180+"deg) ",1!==o.mu&&(u+="translateX(-"+o.fillTextWidth/4+"px) scale("+1/o.mu+")");var m={position:"absolute",display:"block",font:n.fontWeight+" "+c*o.mu+"px "+n.fontFamily,left:(e+o.gw/2)*v+o.fillTextOffsetX+"px",top:(i+o.gh/2)*v+o.fillTextOffsetY+"px",width:o.fillTextWidth+"px",height:o.fillTextHeight+"px",color:h,lineHeight:c+"px",whiteSpace:"nowrap",transform:u,webkitTransform:u,msTransform:u,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"};s.textContent=r;for(var g in m)s.style[g]=m[g];if(f)for(var w in f)s.setAttribute(w,f[w]);t.appendChild(s)}})},D=function(e,i,o,r,a){if(!(e>=f||i>=h||0>e||0>i)){if(d[e][i]=!1,o){var n=t[0].getContext("2d");n.fillRect(e*v,i*v,w,w)}b&&(y[e][i]={item:a,dimension:r})}},B=function(e,i,o,r,a,l){var s,d=a.occupied,f=n.drawMask;f&&(s=t[0].getContext("2d"),s.save(),s.fillStyle=n.maskColor);var h;if(b){var c=a.bounds;h={x:(e+c[3])*v,y:(i+c[0])*v,w:(c[1]-c[3]+1)*v,h:(c[2]-c[0]+1)*v}}for(var u=d.length;u--;)D(e+d[u][0],i+d[u][1],f,h,l);f&&s.restore()},X=[],Y=function(t,e){var i,r,a;Array.isArray(t)?(i=t[0],r=t[1]):(i=t.word,r=t.weight,a=t.attributes);var l=z(),s=W(i,r,l);if(!s)return!1;if(F())return!1;var d=s.bounds;if(d[1]-d[3]+1>f||d[2]-d[0]+1>h)return!1;for(var c=u+1,m=function(o){var n=Math.floor(o[0]-s.gw/2),d=Math.floor(o[1]-s.gh/2),f=s.gw,h=s.gh;return L(n,d,f,h,s.occupied)?(A(n,d,s,i,r,u-c,o[2],l,a),0==e&&O(n,d,s,i,r,u-c,o[2],l,a),T[i]={gx:n,gy:d,info:s,word:i,weight:r,distance:u-c,theta:o[2],rotateDeg:l,attributes:a},B(n,d,f,h,s,t),!0):!1};c--;){var g=P(u-c);n.shuffle&&(g=[].concat(g),o(g));var v=g.some(m);if(v)return!0}return X.push(t),!1},q=function(e,i,o){return i?!t.some(function(t){var r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!0,i,o||{}),!t.dispatchEvent(r)},this):void t.forEach(function(t){var r=document.createEvent("CustomEvent");r.initCustomEvent(e,!0,i,o||{}),t.dispatchEvent(r)},this)},H=function(){var e=t[0];if(e.getContext)f=Math.floor(e.width/v),h=Math.floor(e.height/v),I(e);else{var i=e.getBoundingClientRect();f=Math.floor(i.width/v),h=Math.floor(i.height/v)}if(q("wordcloudstart",!0)){c=n.origin?[n.origin[0]/v,n.origin[1]/v]:[f/2,h/2],u=Math.floor(Math.sqrt(f*f+h*h)),d=[];var o,r,a;if(!e.getContext||n.clearCanvas)for(t.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=n.backgroundColor,e.clearRect(0,0,f*(v+1),h*(v+1)),e.fillRect(0,0,f*(v+1),h*(v+1))}else t.textContent="",t.style.backgroundColor=n.backgroundColor}),o=f;o--;)for(d[o]=[],r=h;r--;)d[o][r]=!0;else{var l=document.createElement("canvas").getContext("2d");l.fillStyle=n.backgroundColor,l.fillRect(0,0,1,1);var s=l.getImageData(0,0,1,1).data,g=e.getContext("2d").getImageData(0,0,f*v,h*v).data;o=f;for(var w,p;o--;)for(d[o]=[],r=h;r--;){p=v;t:for(;p--;)for(w=v;w--;)for(a=4;a--;)if(g[4*((r*v+p)*f*v+(o*v+w))+a]!==s[a]){d[o][r]=!1;break t}d[o][r]!==!1&&(d[o][r]=!0)}g=l=s=void 0}if(n.hover||n.click){for(b=!0,o=f+1;o--;)y[o]=[];n.hover&&e.addEventListener("mousemove",S),n.click&&e.addEventListener("click",E),e.addEventListener("wordcloudstart",function z(){e.removeEventListener("wordcloudstart",z),e.removeEventListener("mousemove",S),e.removeEventListener("click",E),M=void 0})}a=0;var x,C;0!==n.wait?(x=window.setTimeout,C=window.clearTimeout):(x=window.setImmediate,C=window.clearImmediate);var T=function(e,i){t.forEach(function(t){t.addEventListener(e,i)},this)},k=function(e,i){t.forEach(function(t){t.removeEventListener(e,i)},this)},R=function W(){k("wordcloudstart",W),C(P)};T("wordcloudstart",R);var P=x(function L(){if(0==a&&q("wordcloudstartrender",!1),a>=n.list.length)return C(P),q("wordcloudstop",!1),void k("wordcloudstart",R);m=(new Date).getTime();var t=Y(n.list[a],a),e=!q("wordclouddrawn",!0,{item:n.list[a],drawn:t});return F()||e?(C(P),n.abort(),q("wordcloudabort",!1),q("wordcloudstop",!1),void k("wordcloudstart",R)):(a++,void(P=x(L,n.wait)))},n.wait)}};H()}};r.isSupported=e,r.miniumFontSize=i,"function"==typeof t.define&&t.define.amd?t.define("wordcloud",[],function(){return r}):"undefined"!=typeof t.module&&t.module.exports?t.module.exports=r:t.WordCloud=r}(window);